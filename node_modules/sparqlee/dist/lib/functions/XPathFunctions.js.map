{"version":3,"file":"XPathFunctions.js","sourceRoot":"","sources":["../../../lib/functions/XPathFunctions.ts"],"names":[],"mappings":"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","sourcesContent":["\n// https://www.w3.org/TR/xpath-functions/#func-matches\n// https://www.w3.org/TR/xpath-functions/#flags\nexport function matches(text: string, pattern: string, flags?: string): boolean {\n  // TODO: Only flags 'i' and 'm' match between XPath and JS.\n  // 's', 'x', 'q', would need proper implementation.\n  const reg = new RegExp(pattern, flags);\n  return reg.test(text);\n}\n\n// TODO: Fix flags\n// https://www.w3.org/TR/xpath-functions/#func-replace\nexport function replace(arg: string, pattern: string, replacement: string, flags?: string): string {\n  let reg = new RegExp(pattern, flags);\n  if (!reg.global) {\n    const flags_ = flags || '';\n    reg = new RegExp(pattern, flags_ + 'g');\n  }\n  return arg.replace(reg, replacement);\n}\n\n// TODO: Not an XPath function\n// TODO: Publish as package\n// https://www.ietf.org/rfc/rfc4647.txt\n// https://www.w3.org/TR/sparql11-query/#func-langMatches\nexport function langMatches(tag: string, range: string): boolean {\n  const langTags = tag.split('-');\n  const rangeTags = range.split('-');\n\n  if (!_matchLangTag(rangeTags[0], langTags[0])\n    && !_isWildCard(langTags[0])) { return false; }\n\n  let lI = 1;\n  let rI = 1;\n  while (rI < rangeTags.length) {\n    if (_isWildCard(rangeTags[rI])) { rI++; continue; }\n    if (lI === langTags.length) { return false; }\n    if (_matchLangTag(rangeTags[rI], langTags[lI])) { lI++; rI++; continue; }\n    if (langTags[lI].length === 1) { return false; }\n    lI++;\n  }\n  return true;\n}\n\nfunction _isWildCard(tag: string): boolean {\n  return tag === '*';\n}\n\nfunction _matchLangTag(left: string, right: string): boolean {\n  const matchInitial = new RegExp(`/${left}/`, 'i');\n  return matchInitial.test(`/${right}/`);\n}\n\n/**\n * Formats a timezone string into a XML DayTimeDuration\n *\n * TODO: Test\n * Used in fn:timezone\n * http://www.datypic.com/sc/xsd/t-xsd_dayTimeDuration.html\n */\nexport function formatDayTimeDuration(timezone: string) {\n  if (!timezone) { return undefined; }\n  if (timezone[0] === 'Z') {\n    return 'PT0S';\n  } else {\n    // Split string\n    const [sign, h1Raw, h2Raw, _, m1Raw, m2Raw] = timezone;\n\n    // Cut of leading zero, set to empty string if 0, and append H;\n    const h1 = (h1Raw !== '0') ? h1Raw : '';\n    const h2 = (h1 || h2Raw !== '0') ? h2Raw : '';\n    const hours = (h1 + h2) ? h1 + h2 + 'H' : '';\n\n    // Same as in hours\n    const m1 = (m1Raw !== '0') ? m1Raw : '';\n    const m2 = (m1 || m2Raw !== '0') ? m2Raw : '';\n    const minutes = (m1 + m2) ? m1 + m2 + 'M' : '';\n\n    // Concat sign and time and mandatory separators\n    const time = `${hours}${minutes}`;\n    const signNoPlus = (sign === '-') ? '-' : '';\n    return `${signNoPlus}PT${time}`;\n  }\n}\n"]}